<img alt="Static Badge" src="https://img.shields.io/badge/Since-1.1.24.3-blue?style=flat">

You may have your own vulnerability templates you have been building up over the years or you may rather edit your templates in another editor like Obsidian or Sublime instead of the web interface.  Either way, Faction allows you to upload your templates in CSV and JSON formats via the API. The reports can be in markdown, HTML, or a combination of both. 

The api docs can be found on your instance by navigating to  https: //YourHost/api-docs:
![](files/Pasted%20image%2020240209094649.png)

### Generating an API Key
You must have the `API Key` permission on your user to use the API. It it not set by default. 
![](files/Pasted%20image%2020240209150827.png)

Once the setting is enabled you can access your API Key by clicking on your profile in the upper right corner of Faction. Clicking anywhere inside the API key box will expose the key to you.
![](files/Pasted%20image%2020240209151003.png)


## CSV File Structure
| Id* | Name | Category Id* | Category Name* | Description | Recommendation | Severity Id | Impact Id | Likelihood Id |  active | 
| --- | --- | --- | --- |  --- | --- | --- | --- |  --- | --- |

**If the ID is empty** then a new vulnerability will be created. If the ID is populated then it will overwrite the vulnerability with the same id.

**If the Category Id is missing** then categoryName is required. If a category with the same name exists then the existing category will be used.

**If the categoryName does not match** an existing category then a new category will be created. 

**If the Category Id is populated** then the Category Name field is ignored.

### Example 1: Create a New Vulnerability Template in CSV

__Example CSV__
```csv
,"Cross Site Scripting",, Unvalidated Input, "XSS is Bad and stuff..\n```\nCode snippet\n```", "Fix it! here is a link [here](https://www.a.b.com)", 4, 4,4,true
```

The above example will create one new template for cross-site scripting. A few things to notice:

1. The first column (the id column) is blank. Since there isn't an ID to relate it, a new template will be created. 
2. The 3rd column (category Id) is blank so Faction will need to look at the 4th column (category name). If `Unvalidated Input` is not already a category in Faction, then Faction will create it. 
3. The Description and Recommendation are in markdown syntax. These columns need to be in double quotes (`"`) and have new lines escaped (`\n`). 
4. The severity IDs need to match the severity levels you have set in Faction. These numbers can be found in Admin->Settings-> Risk Level Settings. The defaults are Critical (5), High (4), Medium (3), Low(2), Recommended (1), Informational (0).

__Submit through the API__
```bash
curl -X 'POST' \ 
'http://localhost:8080/api/vulnerabilities/csv/default' \ 
-H 'accept: application/json' \ 
-H 'FACTION-API-KEY: 6be51daa-6f6f-42d3-8b04-b924a0045eff' \ 
-H 'Content-Type: text/plain' \ 
-d ',"Cross Site Scripting",, Unvalidated Input, "XSS is Bad and stuff..\n```\nCode snippet\n```", "Fix it! here is a link [here](https://www.a.b.com)", 4, 4,4,true'
```

### Example 2: Updating a Vulnerability Template in CSV
First, you need to download the current list of vulnerabilities from the API.

__Get a CSV List of Default Vulnerabilities__
```bash
curl -X 'GET' \ 
'http://localhost:8080/api/vulnerabilities/csv/default' \ 
-H 'accept: text/csv' \ 
-H 'FACTION-API-KEY: 6be51daa-6f6f-42d3-8b04-b924a0045eff'
```

Example Response:
```csv
"2","Generic Vulnerability","2","Uncategorized","","","4","4","4","true" "18","Cross Site Scripting","4","Unvalidated Input","<p>XSS is Bad and stuff..</p> <pre><code>Code snippet </code></pre> <br />","<p>Fix it! here is a link <a href=""https://www.a.b.com"">here</a></p> <br />","4","4","4","true"
```

__Now to Update a Template__
Let's update the Cross Site Scripting Template by changing the description to 
```
XSS is fun to exploit with this code snippet\n ```\nSnipity snip\n```
```

The API Request would look like this:
```bash
curl -X 'POST' \ 
'http://localhost:8080/api/vulnerabilities/csv/default' \ 
-H 'accept: application/json' \ 
-H 'FACTION-API-KEY: 6be51daa-6f6f-42d3-8b04-b924a0045eff' \ 
-H 'Content-Type: text/plain' \ 
-d '"18","Cross Site Scripting","4","Unvalidated Input","XSS is fun to exploit with this code snippet\n ```\nSnipity snip\n```","<p>Fix it! here is a link <a href=""https://www.a.b.com"">here</a></p> <br />","4","4","4","true"'
```

Now if we pull the list again the results look like this:
__Request__
```bash
curl -X 'GET' \ 
'http://localhost:8080/api/vulnerabilities/csv/default' \ 
-H 'accept: text/csv' \ 
-H 'FACTION-API-KEY: 6be51daa-6f6f-42d3-8b04-b924a0045eff'
```

__Response__
```csv
"2","Generic Vulnerability","2","Uncategorized","","","4","4","4","true" "18","Cross Site Scripting","4","Unvalidated Input","<p>XSS is fun to exploit with this code snippet</p> <pre><code>Snipity snip </code></pre> <br />","<p>Fix it! here is a link <a href=""https://www.a.b.com"">here</a></p> <br /> <br />","4","4","4","true"
```


## JSON File Structure
```json
  [
	  {
	    "Id": 2,
	    "Name": "Generic Vulnerability",
	    "CategoryId": 2,
	    "CategoryName": "Uncategorized",
	    "Description": "",
	    "Recommendation": "",
	    "SeverityId": 4,
	    "LikelihoodId": 4,
	    "ImpactId": 4,
	    "Active": true
	  }
  ]
```

**If the ID is missing** then a new vulnerability will be created. If the ID is populated then it will overwrite the vulnerability with the same id.

**If the Category Id is missing** then categoryName is required. If a category with the same name exists then the existing category will be used.

**If the categoryName does not match** an existing category then a new category will be created. 

**If the Category Id is populated** then the Category Name field is ignored.

### Example 1: Create All New Vulnerability Template in JSON

__Example JSON__

```json
[
	{
		"Name": "Cross Site Scripting",
		"CategoryName": "Unvalidated Input",
		"Description": "XSS is Bad and stuff..\n```\nCode snippet\n```",
		"Recommendation": "Fix it! here is a link [here](https://www.a.b.com)",
		"LikelihoodId": 4,
		"ImpactId": 4,
		"SeverityId": 4,
		"Active": true
	}
]
```

The above example will create one new template for cross-site scripting. A few things to notice:

1. The ID is Missing. Since there isn't an ID to relate it, a new template will be created. 
3. The CategoryId is missing so Faction will need to look at the CategoryName. If `Unvalidated Input` is not already a category then Faction will create it. 
4. The Description and Recommendation are markdown syntax. 
5. The severity IDs need to match the severity levels you have set in Faction. These numbers can be found in Admin->Settings-> Risk Level Settings. The defaults are Critical (5), High (4), Medium (3), Low(2), Recommended (1), Informational (0).

The API Request looks like this to add this vulnerability template:
```bash
curl -X 'POST' \ 
'http://localhost:8080/api/vulnerabilities/default' \ 
-H 'accept: application/json' \ 
-H 'FACTION-API-KEY: a0d2fff7-7462-458c-ba7b-d93d99b7280a' \ 
-H 'Content-Type: application/json' \ 
-d '[ 
	{ 
		"Name": "Cross Site Scripting", 
		"CategoryName": "Unvalidated Input", 
		"Description": "XSS is Bad and stuff..\n```\nCode snippet\n```",
		"Recommendation": "Fix it! here is a link [here](https://www.a.b.com)",
		"LikelihoodId": 4, 
		"ImpactId": 4, 
		"SeverityId": 4, 
		"Active": true 
	} 
]'
```

### Example 2: Updating a Vulnerability Template in JSON
First, you need to download the current list of vulnerabilities from the API.

__Get a JSON List of Default Vulnerabilities__
```bash
curl -X 'GET' \ 
'http://localhost:8080/api/vulnerabilities/default' \ 
-H 'accept: application/json' \ 
-H 'FACTION-API-KEY: a0d2fff7-7462-458c-ba7b-d93d99b7280a'
```

Response:
```json
[
  {
    "CategoryId": 2,
    "ImpactId": 4,
    "Active": true,
    "Description": "",
    "CategoryName": "Uncategorized",
    "LikelihoodId": 4,
    "Id": 2,
    "Recommendation": "",
    "SeverityId": 4,
    "Name": "Generic Vulnerability"
  },
  {
    "CategoryId": 4,
    "ImpactId": 4,
    "Active": true,
    "Description": "XSS is Bad and stuff..\n```\nCode snippet\n```",
    "CategoryName": "Unvalidated Input",
    "LikelihoodId": 4,
    "Id": 5,
    "Recommendation": "Fix it! here is a link [here](https://www.a.b.com)",
    "SeverityId": 4,
    "Name": "Cross Site Scripting"
  }
]
```

__Now to Update a Template__
Let's update the Cross Site Scripting Template by changing the description to 
```
XSS is fun to exploit with this code snippet\n ```\nSnipity snip\n```
```

The API Request would look like this:
```bash
curl -X 'POST' \
  'http://localhost:8080/api/vulnerabilities/default' \
  -H 'accept: application/json' \
  -H 'FACTION-API-KEY: a0d2fff7-7462-458c-ba7b-d93d99b7280a' \
  -H 'Content-Type: application/json' \
  -d '[ {
    "CategoryId": 4,
    "ImpactId": 4,
    "Active": true,
    "Description": "XSS is fun to exploit with this code snippet\n ```\nSnipity snip\n```",
    "CategoryName": "Unvalidated Input",
    "LikelihoodId": 4,
    "Id": 5,
    "Recommendation": "Fix it! here is a link [here](https://www.a.b.com)",
    "SeverityId": 4,
    "Name": "Cross Site Scripting"
  }]'
```

Now if we pull the list again the results look like this:
__Request__
```bash
curl -X 'GET' \ 
'http://localhost:8080/api/vulnerabilities/default' \ 
-H 'accept: text/csv' \ 
-H 'FACTION-API-KEY: 6be51daa-6f6f-42d3-8b04-b924a0045eff'
```

__Response__
```json
[
  {
    "CategoryId": 2,
    "ImpactId": 4,
    "Active": true,
    "Description": "",
    "CategoryName": "Uncategorized",
    "LikelihoodId": 4,
    "Id": 2,
    "Recommendation": "",
    "SeverityId": 4,
    "Name": "Generic Vulnerability"
  },
  {
    "CategoryId": 4,
    "ImpactId": 4,
    "Active": true,
    "Description": "<p>XSS is fun to exploit with this code snippet</p>\n<pre><code>Snipity snip\n</code></pre>\n<br />",
    "CategoryName": "Unvalidated Input",
    "LikelihoodId": 4,
    "Id": 5,
    "Recommendation": "<p>Fix it! here is a link <a href=\"https://www.a.b.com\">here</a></p>\n<br />",
    "SeverityId": 4,
    "Name": "Cross Site Scripting"
  }
]
```

## Using Swagger
Instead of using CURL as show above you can use the API docs pages to submit directly to your API to test things out. 

Just navigate to `https: //YourHost/api-docs` and select any of the API's available. You will need your API Key that can be found in your profile.
Example of using swagger to update a Template with JSON.
![](files/Pasted%20image%2020240209150600.png)

