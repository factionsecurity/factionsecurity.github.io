
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Custom%20Security%20Report%20Templates/">
      
      
        <link rel="next" href="../FACTION%20Plugin%20Extension%20API/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.2">
    
    
      
        <title>Extending FACTION - </title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#faction-dev-environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="" class="md-header__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="/img/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Extending FACTION
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/factionsecurity/faction" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="" class="md-nav__button md-logo" aria-label="" data-md-component="logo">
      
  <img src="/img/favicon.png" alt="logo">

    </a>
    
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/factionsecurity/faction" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to FACTION
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Custom%20Security%20Report%20Templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Custom Security Report Templates
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Extending FACTION
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Extending FACTION
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#faction-dev-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Faction Dev Environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-jira-plugin-class" class="md-nav__link">
    <span class="md-ellipsis">
      Create The Jira Plugin Class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      Putting It All Together
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-it-in-your-faction" class="md-nav__link">
    <span class="md-ellipsis">
      Install It In Your Faction
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../FACTION%20Plugin%20Extension%20API/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FACTION Plugin Extension API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Integrate%20Faction%20into%20OAuth%20Solutions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrate Faction into OAuth Solutions
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Managed%20FACTION%20Setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Managed FACTION Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Self-Hosted%20FACTION%20Setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Self Hosted FACTION Setup
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#faction-dev-environment" class="md-nav__link">
    <span class="md-ellipsis">
      Faction Dev Environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-the-jira-plugin-class" class="md-nav__link">
    <span class="md-ellipsis">
      Create The Jira Plugin Class
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#putting-it-all-together" class="md-nav__link">
    <span class="md-ellipsis">
      Putting It All Together
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-it-in-your-faction" class="md-nav__link">
    <span class="md-ellipsis">
      Install It In Your Faction
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Extending FACTION</h1>

<p>Faction can extend its functionality on the server side. If you are familiar with writing BurpSuite extensions then this process should be somewhat familiar to you. If you are not it’s OK. We will walk through the specifics below.</p>
<p>In this example, we will create a JIRA plugin that will create issues for each vulnerability when the assessment is finalized.</p>
<p>The source code for this example can be <a href="https://github.com/factionsecurity/JiraPluginExample">downloaded here</a>.</p>
<h2 id="faction-dev-environment">Faction Dev Environment</h2>
<ol>
<li>Create a new Eclipse Maven Java Project</li>
<li>Add the following lines to your <em>pom.xml</em> file to enable the Faction Extendar API. This adds the Extendar API Repository location, the Extendar Library, and configures the build plugin, and Manifest file.</li>
</ol>
<pre><code class="language-xml">&lt;repositories&gt;
   &lt;repository&gt;
      &lt;id&gt;FactionExtender&lt;/id&gt;
      &lt;url&gt;https://github.com/factionsecurity/faction-extender/raw/mvn-repo/&lt;/url&gt;
      &lt;snapshots&gt;
         &lt;enabled&gt;true&lt;/enabled&gt;
         &lt;updatePolicy&gt;always&lt;/updatePolicy&gt;
      &lt;/snapshots&gt;
   &lt;/repository&gt;
&lt;/repositories&gt;
&lt;dependencies&gt;
   &lt;dependency&gt;
      &lt;groupId&gt;FactionExtender&lt;/groupId&gt;
      &lt;artifactId&gt;FactionExtender&lt;/artifactId&gt;
      &lt;version&gt;1.1&lt;/version&gt;
   &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;build&gt;
   &lt;plugins&gt;
      &lt;plugin&gt;
         &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;
         &lt;configuration&gt;
         &lt;descriptorRefs&gt;
            &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;
         &lt;/descriptorRefs&gt;
         &lt;archive&gt; 
            &lt;manifestEntries&gt;
               &lt;Import-Library&gt;org.faction.JiraPlugin&lt;/Import-Library&gt;
            &lt;/manifestEntries&gt;
         &lt;/archive&gt;
         &lt;/configuration&gt;
       &lt;/plugin&gt;
   &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>
<p>The <em>maven-assembly-plugin</em> contains the manifest entries which is important for Faction to be able to find the correct class files to run. You will need to update the <strong>Import-Library</strong> directive to point to your class.</p>
<h2 id="create-the-jira-plugin-class">Create The Jira Plugin Class</h2>
<p>Create a Class named <strong>JiraPlugin</strong> in <em>src/main/java</em>. This class will implement  <em>com.fuse.extender.AssessmentManager</em> as shown below. This code will trigger whenever a change happens to an assessment. You can use the <strong>Operation</strong> enum to control what happens as different events change the assessment.</p>
<pre><code class="language-java">public class JiraPlugin implements com.fuse.extender.AssessmentManager{
     @Override
     public Object[] assessmentChange(Assessment assessment, List&lt;Vulnerability&gt; vulnerabilities, Operation arg2) {
            return new Object [] {assessment, vulnerabilities};
     }
}
</code></pre>
<p>Note that above it returns <strong>Object [] {assessment, vulnerabilities}.</strong> This will update Faction’s database if the values change when this function returns. If you Return <strong>null</strong> it will NOT update Faction and only just send/process information.</p>
<h2 id="putting-it-all-together">Putting It All Together</h2>
<p>Now we have a basic functional block of code we need to make it perform the action of sending all vulnerabilities to Jira only when the assessment is finalized. To do this we create an if statement that checks the Operation enum equals Finalized.</p>
<pre><code class="language-java">import com.fuse.elements.Assessment;
import com.fuse.elements.Vulnerability;

public class JiraPlugin implements com.fuse.extender.AssessmentManager{

    @Override
    public Object[] assessmentChange(Assessment assessment, List&lt;Vulnerability&gt; vulns, Operation opcode) {

        if(opcode == Operation.Finalize) {
            //Integration into vulnerability management system
            for(Vulnerability vuln : vulns) {
                //this can update vulns and send the updated values back into Faction
                String issueId = sendVulnerbilityToJira(vuln);
                if(issueId != null) {
                    vuln.setTracking(issueId);
                }
            }
        }
        return new Object [] {assessment, vulns};
    }
}


</code></pre>
<p>Now we just need to add the following supporting functions to send the issues to Jira using their <a href="https://docs.atlassian.com/software/jira/docs/api/REST/8.9.1/">REST API</a>. <strong>Note: To use this code you need to update the Environment Variables to use your Jira Hostname and API key. You also need to update the Project key to match your projects.</strong></p>
<pre><code class="language-java">import java.util.Base64;
import java.util.List;

import com.fuse.elements.Assessment;
import com.fuse.elements.Vulnerability;

import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.HttpClientBuilder;
import org.apache.http.util.EntityUtils;
import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;

public class JiraPlugin implements com.fuse.extender.AssessmentManager{

    @Override
    public Object[] assessmentChange(Assessment assessment, List vulns, Operation opcode) {

        if(opcode == Operation.Finalize) {
            //Integration into vulnerability management system
            for(Vulnerability vuln : vulns) {
                //this can update vulns and send the updated values back into Faction
                String issueId = sendVulnerbilityToJira(vuln);
                if(issueId != null) {
                    vuln.setTracking(issueId);
                }
            }
        }
        return new Object [] {assessment, vulns};
    }

    public String sendVulnerbilityToJira(Vulnerability vuln) {

        JSONObject issueType = new JSONObject();
        issueType.put(&quot;name&quot;, &quot;Bug&quot;);

        JSONObject project = new JSONObject();
        project.put(&quot;key&quot;, &quot;KAN&quot;); //Change this

        JSONObject fields = new JSONObject();
        fields.put(&quot;summary&quot;, vuln.getName());
        fields.put(&quot;description&quot;, vuln.getDescription());
        fields.put(&quot;project&quot;, project);
        fields.put(&quot;issuetype&quot;, issueType);

        JSONObject issue = new JSONObject();
        issue.put(&quot;fields&quot;, fields);
        String jiraHost = System.getenv(&quot;JIRA_HOST&quot;);
        String jiraURL = String.format(&quot;%s%s&quot;, jiraHost, &quot;rest/api/2/issue/&quot;);
        return httpPost(jiraURL, issue);
    }

    private String base64(String data) {
        return &quot;Basic &quot; +Base64.getEncoder().encodeToString(data.getBytes());
    }

    private String httpPost(String url, JSONObject payload) {
        HttpClient httpClient = HttpClientBuilder.create().build();
        String apiKey = System.getenv(&quot;JIRA_API_KEY&quot;);
        try {
            HttpPost request = new HttpPost(url);
            StringEntity params = new StringEntity(payload.toJSONString());
            request.addHeader(&quot;content-type&quot;, &quot;application/json&quot;);
            request.addHeader(&quot;Authorization&quot;, base64(apiKey));
            request.setEntity(params);
            HttpResponse response = httpClient.execute(request);
            if( response.getStatusLine().getStatusCode() == 201) {
                String json = EntityUtils.toString(response.getEntity());
                JSONParser parser = new JSONParser();
                JSONObject jsonObj = (JSONObject) parser.parse(json);
                return (String) jsonObj.get(&quot;id&quot;);
            }else {
                return null;
            }
        } catch (Exception ex) {
            ex.printStackTrace();
            return &quot;&quot;;
        } 

    }
}
</code></pre>
<h2 id="install-it-in-your-faction">Install It In Your Faction</h2>
<p>Build the jar file by running:</p>
<pre><code>mvn clean compile assembly:single
</code></pre>
<p>This will create a jar file named <strong>JiraPlugin-0.0.1-SNAPSHOT-jar-with-dependencies.jar</strong> in your ./target folder. </p>
<p>To run it on Faction, you need to copy <strong>JiraPlugin-0.0.1-SNAPSHOT-jar-with-dependencies.jar</strong> into the <strong>/opt/faction/modules/</strong> folder on your server. The Faction web server with automatically pick up this change without restarting and will execute your custom code when when the assessment is finalized. </p>
<p>Now when an assessment is finalized it will add All the findings to JIRA as shown in the following screenshot:</p>
<p><img alt="" src="../files/Pasted%20image%2020231218085522.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
    
  </body>
</html>